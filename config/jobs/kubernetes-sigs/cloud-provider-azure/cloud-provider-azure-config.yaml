presubmits:
  kubernetes-sigs/cloud-provider-azure:
  - name: pull-cloud-provider-azure-check
    skip_if_only_changed: "^docs/|^site/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)$"
    decorate: true
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - make
        - test-check
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-check
      description: "Run lint check tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmss-capz runs Azure specific e2e tests on vmss.
  - name: pull-cloud-provider-azure-e2e-ccm-vmss-capz
    skip_if_only_changed: "^docs/|^site/|^helm/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)$"
    decorate: true
    decoration_config:
      timeout: 3h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
      - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-cred-only: "true"
      preset-azure-anonymous-pull: "true"
    extra_refs:
      - org: kubernetes-sigs
        repo: cluster-api-provider-azure
        base_ref: main
        path_alias: sigs.k8s.io/cluster-api-provider-azure
        workdir: true
    spec:
      containers:
        - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
          command:
          - runner.sh
          args:
          - ./scripts/ci-entrypoint.sh
          - bash
          - -c
          - >-
            cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
            make test-ccm-e2e
          securityContext:
            privileged: true
          env:
            - name: TEST_CCM
              value: "true"
            - name: CONTROL_PLANE_MACHINE_COUNT
              value: "1"
            - name: KUBERNETES_VERSION
              value: "latest"
            - name: CLUSTER_TEMPLATE
              value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version.yaml
            - name: AZURE_LOADBALANCER_SKU
              value: "Standard"
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmss-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss, using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-capz runs kubernetes conformance tests.
  - name: pull-cloud-provider-azure-e2e-capz
    skip_if_only_changed: "^docs/|^site/|^helm/|^tests/e2e/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)$"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
      - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-cred-only: "true"
      preset-azure-anonymous-pull: "true"
    extra_refs:
      - org: kubernetes-sigs
        repo: cluster-api-provider-azure
        base_ref: release-1.3
        path_alias: sigs.k8s.io/cluster-api-provider-azure
        workdir: true
      - org: kubernetes
        repo: kubernetes
        base_ref: master
        path_alias: k8s.io/kubernetes
        workdir: false
    spec:
      containers:
        - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
          command:
          - runner.sh
          args:
          - ./scripts/ci-entrypoint.sh
          - bash
          - -c
          - >-
            cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
            cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
            make test-e2e-capz
          securityContext:
            privileged: true
          env:
            - name: TEST_CCM
              value: "true"
            - name: AZURE_LOADBALANCER_SKU
              value: "standard"
            - name: KUBERNETES_VERSION
              value: "latest"
            - name: GINKGO_ARGS
              value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\] --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
            - name: CONTROL_PLANE_MACHINE_COUNT
              value: "1"
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-capz
      description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-capz runs Azure specific e2e tests.
  - name: pull-cloud-provider-azure-e2e-ccm-capz
    skip_if_only_changed: "^docs/|^site/|^helm/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)$"
    decorate: true
    decoration_config:
      timeout: 3h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
      - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-cred-only: "true"
      preset-azure-anonymous-pull: "true"
    extra_refs:
      - org: kubernetes-sigs
        repo: cluster-api-provider-azure
        base_ref: release-1.3
        path_alias: sigs.k8s.io/cluster-api-provider-azure
        workdir: true
    spec:
      containers:
        - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
          command:
          - runner.sh
          args:
          - ./scripts/ci-entrypoint.sh
          - bash
          - -c
          - >-
            cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
            make test-ccm-e2e
          securityContext:
            privileged: true
          env:
            - name: TEST_CCM
              value: "true"
            - name: AZURE_LOADBALANCER_SKU
              value: "standard"
            - name: CONTROL_PLANE_MACHINE_COUNT
              value: "1"
            - name: KUBERNETES_VERSION
              value: "latest"
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-unit
    skip_if_only_changed: "^docs/|^site/|^helm/|^tests/e2e/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)$"
    decorate: true
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - make
        - test-unit
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-unit
      description: "Run unit tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
periodics:
- interval: 24h
  # cloud-provider-azure-master-capz runs Azure specific tests periodically using a stable capz release.
  name: cloud-provider-azure-master-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.3
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    - org: kubernetes-sigs
      repo: cloud-provider-azure
      base_ref: master
      path_alias: sigs.k8s.io/cloud-provider-azure
      workdir: false
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM
          value: "true"
        - name: AZURE_LOADBALANCER_SKU
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT
          value: "1"
        - name: KUBERNETES_VERSION
          value: "latest"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release."
- interval: 24h
  # cloud-provider-azure-master-capz runs Azure specific tests periodically using capz:main.
  name: cloud-provider-azure-master-capz-main
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: main
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    - org: kubernetes-sigs
      repo: cloud-provider-azure
      base_ref: master
      path_alias: sigs.k8s.io/cloud-provider-azure
      workdir: false
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM
          value: "true"
        - name: AZURE_LOADBALANCER_SKU
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT
          value: "1"
        - name: KUBERNETES_VERSION
          value: "latest"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-capz-main
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using capz:main."
- interval: 24h
  name: cloud-provider-azure-ccm-windows-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.3
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    - org: kubernetes-sigs
      repo: cloud-provider-azure
      base_ref: master
      path_alias: sigs.k8s.io/cloud-provider-azure
      workdir: false
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM
          value: "true"
        - name: AZURE_LOADBALANCER_SKU
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT
          value: "1"
        - name: TEST_WINDOWS
          value: "true"
        - name: WINDOWS_FLAVOR
          value: "containerd-2022"
        - name: KUBERNETES_VERSION
          value: "latest"
        - name: WORKER_MACHINE_COUNT
          value: "0"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-ccm-windows-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "[Windows] Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- interval: 24h
  # cloud-provider-azure-conformance-capz runs Kubernetes conformance tests periodically.
  name: cloud-provider-azure-conformance-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.3
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: AZURE_LOADBALANCER_SKU
        value: "standard"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\] --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- interval: 24h
  name: cloud-provider-azure-conformance-windows-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.3
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: AZURE_LOADBALANCER_SKU
        value: "standard"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\]|\[LinuxOnly\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\] --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
      - name: TEST_WINDOWS
        value: "true"
      - name: WINDOWS_FLAVOR
        value: "containerd-2022"
      - name: WORKER_MACHINE_COUNT
        value: "0"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-windows-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "[Windows] Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- interval: 24h
  # cloud-provider-azure-slow-capz runs Kubernetes slow tests periodically.
  name: cloud-provider-azure-slow-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: AZURE_LOADBALANCER_SKU
        value: "standard"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        value: --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|In-tree.Volumes|should.be.able.to.create.an.internal.type.load.balancer --test.parallel=4 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-slow-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- interval: 24h
  # cloud-provider-azure-master-vmss-capz runs Azure specific tests periodically using a stable capz release on vmss.
  name: cloud-provider-azure-master-vmss-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: main
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    - org: kubernetes-sigs
      repo: cloud-provider-azure
      base_ref: master
      path_alias: sigs.k8s.io/cloud-provider-azure
      workdir: false
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT
          value: "1"
        - name: KUBERNETES_VERSION
          value: "latest"
        - name: CLUSTER_TEMPLATE
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version.yaml
        - name: AZURE_LOADBALANCER_SKU
          value: "Standard"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss using a stable capz release."
- interval: 24h
  # cloud-provider-azure-conformance-vmss-capz runs Kubernetes conformance tests periodically on vmss.
  name: cloud-provider-azure-conformance-vmss-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\] --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
      - name: CLUSTER_TEMPLATE
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU
        value: "Standard"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
- interval: 24h
  # cloud-provider-azure-conformance-serial-vmss-capz runs Kubernetes conformance serial tests periodically on vmss.
  name: cloud-provider-azure-conformance-serial-vmss-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        # Check https://github.com/kubernetes-sigs/cloud-provider-azure/issues/224 for the status of each skipped test
        value: --ginkgo.focus=\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\]|regular.resource.usage.tracking.resource.tracking.for|validates.MaxPods.limit.number.of.pods.that.are.allowed.to.run|In-tree.Volumes|RuntimeClass.should.run.a.Pod.requesting.a.RuntimeClass.with.scheduling.with.taints|Multi-AZ.Clusters.should.spread.the.pods.of.a.replication.controller.across.zones|Multi-AZ.Clusters.should.spread.the.pods.of.a.service.across.zones|Should.test.that.pv.used.in.a.pod.that.is.deleted.while.the.kubelet.is.down.cleans.up.when.the.kubelet.returns|Should.test.that.pv.used.in.a.pod.that.is.force.deleted.while.the.kubelet.is.down.cleans.up.when.the.kubelet.returns|Should.test.that.pv.written.before.kubelet.restart.is.readable.after.restart|subPath.should.unmount.if.pod.is.force.deleted.while.kubelet.is.down|subPath.should.unmount.if.pod.is.gracefully.deleted.while.kubelet.is.down|Should.test.that.pv.written.before.kubelet.restart.is.readable.after.restart --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
      - name: CLUSTER_TEMPLATE
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU
        value: "Standard"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-serial-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes serial conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
- interval: 24h
  # cloud-provider-azure-conformance-multiple-zones-vmss-capz runs Kubernetes conformance tests periodically on vmss multiple zones.
  name: cloud-provider-azure-conformance-multiple-zones-vmss-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        # Check https://github.com/kubernetes-sigs/cloud-provider-azure/issues/224 for the status of each skipped test
        value: --ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|Delete.Grace.Period|runs.ReplicaSets.to.verify.preemption.running.path|client.go.should.negotiate|should.contain.custom.columns.for.each.resource|Network.should.set.TCP.CLOSE_WAIT.timeout|PodSecurityPolicy|In-tree.Volumes|ephemeral.should.support.expansion.of.pvcs.created.for.ephemeral.pvcs --test.parallel=30 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
      - name: CLUSTER_TEMPLATE
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-multiple-zones-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU
        value: "Standard"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-multiple-zones-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss multiple zones."
- interval: 24h
  # cloud-provider-azure-slow-vmss-capz runs Kubernetes slow tests periodically.
  name: cloud-provider-azure-slow-vmss-capz
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-cred-only: "true"
    preset-azure-anonymous-pull: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM
        value: "true"
      - name: KUBERNETES_VERSION
        value: "latest"
      - name: GINKGO_ARGS
        value: --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|In-tree.Volumes|should.be.able.to.create.an.internal.type.load.balancer --test.parallel=4 --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT
        value: "1"
      - name: CLUSTER_TEMPLATE
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU
        value: "Standard"
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-slow-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
- interval: 24h
  # cloud-provider-azure-multiple-zones runs Kubernetes multiple availability zones tests periodically.
  name: cloud-provider-azure-multiple-zones
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-service-account: "true"
    preset-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: release-1.23
    path_alias: k8s.io/kubernetes
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20220614-cde7860a33-master
      command:
      - runner.sh
      - kubetest
      args:
      # Generic e2e test args
      - --test
      - --up
      - --down
      - --build=quick
      - --dump=$(ARTIFACTS)
      # Azure-specific test args
      - --deployment=aksengine
      - --provider=skeleton
      - --aksengine-agentpoolcount=2
      - --aksengine-admin-username=azureuser
      - --aksengine-creds=$(AZURE_CREDENTIALS)
      - --aksengine-orchestratorRelease=1.23
      - --aksengine-mastervmsize=Standard_DS2_v2
      - --aksengine-agentvmsize=Standard_D4s_v3
      - --aksengine-ccm
      - --aksengine-cnm
      - --aksengine-deploy-custom-k8s
      - --aksengine-public-key=$(AZURE_SSH_PUBLIC_KEY_FILE)
      - --aksengine-template-url=https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss-multi-zones.json
      - --aksengine-download-url=https://github.com/Azure/aks-engine/releases/download/nightly/aks-engine-nightly-linux-amd64.tar.gz
      # Specific test args
      # Check https://github.com/kubernetes-sigs/cloud-provider-azure/issues/224 for the status of each skipped test
      - --test_args=--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|Delete.Grace.Period|runs.ReplicaSets.to.verify.preemption.running.path|client.go.should.negotiate|should.contain.custom.columns.for.each.resource|Network.should.set.TCP.CLOSE_WAIT.timeout|PodSecurityPolicy
      - --ginkgo-parallel=15
      securityContext:
        privileged: true
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-multiple-zones
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes multiple availability zones tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on VMSS."
