---
presubmits:
  kubernetes-sigs/cloud-provider-azure:
  - name: pull-cloud-provider-azure-check
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore"
    decorate: true
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - make
        - test-check
        resources:
          limits:
            memory: "9Gi"
            cpu: "2"
          requests:
            memory: "9Gi"
            cpu: "2"
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-check
      description: "Run lint check tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmss-capz runs Azure specific e2e tests on vmss.
  - name: pull-cloud-provider-azure-e2e-ccm-vmss-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-machine-pool-ci-version.yaml
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmss-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss, using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-e2e-ccm-ipv6-vmss-capz
    cluster: eks-prow-build-cluster
    always_run: false
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
            # TODO: Should use a 1.29 K8s version
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cluster-template-prow-ipv6-mp.yaml
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-ipv6-vmss-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on IPv6 vmss, using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-e2e-ccm-dualstack-vmss-capz
    cluster: eks-prow-build-cluster
    always_run: false
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cluster-template-prow-dual-stack-mp.yaml
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-dualstack-vmss-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on DualStack vmss, using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmssflex-capz runs Azure specific e2e tests on vmssflex.
  - name: pull-cloud-provider-azure-e2e-ccm-vmssflex-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: TEST_VMSS_FLEX  # cloud-provider-azure config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: ORCHESTRATION_MODE  # CAPZ config
          value: "Flexible"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version-oot-credential-provider.yaml
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: CUSTOM_CLOUD_PROVIDER_CONFIG  # CAPZ config
          value: "https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cloud-config-vmss-default.json"
        - name: ENABLE_VMSS_FLEX  # cloud-provider-azure config
          value: "true"
        - name: ENABLE_MULTI_SLB  # cloud-provider-azure config
          value: "false"
        - name: PUT_VMSS_VM_BATCH_SIZE  # cloud-provider-azure config
          value: "0"
        - name: LB_BACKEND_POOL_CONFIG_TYPE  # cloud-provider-azure config
          value: ""
        - name: HEALTH_PROBE_MODE
          value: "servicenodeport"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmssflex-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmssflex, using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-capz runs kubernetes conformance tests.
  - name: pull-cloud-provider-azure-e2e-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^tests/e2e/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    - org: kubernetes
      repo: kubernetes
      base_ref: master
      path_alias: k8s.io/kubernetes
      workdir: false
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-e2e-capz
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "standard"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: GINKGO_ARGS  # cloud-provider-azure config
          value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\]|Should.be.able.to.support.the.1\.17.Sample.API.Server.using.the.current.Aggregator --report-dir=/logs/artifacts --disable-log-dump=true
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
          value: "30"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-capz
      description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-capz runs Azure specific e2e tests.
  - name: pull-cloud-provider-azure-e2e-ccm-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        - ./scripts/ci-entrypoint.sh
        args:
        - bash
        - -c
        - >-
          pushd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e &&
          popd
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-capz
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-e2e-ccm-ipv6-capz
    cluster: eks-prow-build-cluster
    always_run: false
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        - ./scripts/ci-entrypoint.sh
        args:
        - bash
        - -c
        - >-
          pushd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e &&
          popd
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest-1.28"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-ci-version-ipv6.yaml
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-ipv6-capz
      description: "Runs Azure specific tests with cloud-provider-azure IPv6 (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-e2e-ccm-dualstack-capz
    cluster: eks-prow-build-cluster
    always_run: false
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        - ./scripts/ci-entrypoint.sh
        args:
        - bash
        - -c
        - >-
          pushd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e &&
          popd
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "standard"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest-1.28"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-ci-version-dual-stack.yaml
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-dualstack-capz
      description: "Runs Azure specific tests with cloud-provider-azure DualStack (https://github.com/kubernetes-sigs/cloud-provider-azure) using cluster-api-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmss-ip-lb-capz runs Azure specific e2e tests with cloud controller manager and IP-based load balancer backend pools.
  - name: pull-cloud-provider-azure-e2e-ccm-vmss-ip-lb-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version-oot-credential-provider.yaml
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: ENABLE_MULTI_SLB  # cloud-provider-azure config
          value: "false"
        - name: PUT_VMSS_VM_BATCH_SIZE  # cloud-provider-azure config
          value: "0"
        - name: LB_BACKEND_POOL_CONFIG_TYPE  # cloud-provider-azure config
          value: "nodeIP"
        - name: CUSTOM_CLOUD_PROVIDER_CONFIG  # CAPZ config
          value: "https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cloud-config-vmss-default.json"
        - name: CCM_E2E_ARGS  # cloud-provider-azure config
          value: "-ginkgo.skip=\"\\[Serial\\]\\[Slow\\]|Private\\slink\\sservice|\\[MultipleAgentPools\\]\""
        - name: LABEL_FILTER  # cloud-provider-azure config
          value: "!Serial && !Slow && !PLS && !Multi-Nodepool"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: ENABLE_VMSS_FLEX  # cloud-provider-azure config
          value: "false"
        - name: HEALTH_PROBE_MODE
          value: "servicenodeport"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmss-ip-lb-capz
      description: "Runs Azure specific e2e tests with cloud controller manager and IP-based load balancer backend pools."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmss-multi-slb-capz runs Azure specific e2e tests with cloud controller manager and multiple standard load balancers.
  - name: pull-cloud-provider-azure-e2e-ccm-vmss-multi-slb-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 5h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-no-win-oot-credential-provider.yaml
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: CUSTOM_CLOUD_PROVIDER_CONFIG  # CAPZ config
          value: "https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cloud-config-vmss-multi-slb.json"
        - name: CCM_E2E_ARGS  # cloud-provider-azure config
          value: "-ginkgo.skip=\"\\[Serial\\]\\[Slow\\]|Private\\slink\\sservice|\\[MultipleAgentPools\\]\""
        - name: LABEL_FILTER  # cloud-provider-azure config
          value: "!Serial && !Slow && !PLS && !Multi-Nodepool"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: ENABLE_VMSS_FLEX  # cloud-provider-azure config
          value: "false"
        - name: TEST_MULTI_SLB
          value: "true"
        - name: WINDOWS_WORKER_MACHINE_COUNT
          value: "2"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmss-multi-slb-capz
      description: "Runs Azure specific e2e tests with cloud controller manager and multiple standard load balancers."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-unit
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^tests/e2e/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - make
        - test-unit
        resources:
          limits:
            memory: "9Gi"
            cpu: "2"
          requests:
            memory: "9Gi"
            cpu: "2"
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-unit
      description: "Run unit tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
  # pull-cloud-provider-azure-e2e-ccm-vmss-shared-probe-capz runs Azure specific e2e tests with cloud controller manager and shared health probe.
  - name: pull-cloud-provider-azure-e2e-ccm-vmss-shared-probe-capz
    cluster: eks-prow-build-cluster
    skip_if_only_changed: "^docs/|^site/|^helm/|^pkg/azclient/|^pkg/provider/storage/|^kubetest2-aks/|^.pipelines/|^\\.github/|\\.(md|adoc)$|^(README|LICENSE)|^examples/|^tests/k8s-azure/manifest$|netlify.toml|.codespellignore|go.sum"
    decorate: true
    decoration_config:
      timeout: 3h
    path_alias: sigs.k8s.io/cloud-provider-azure
    branches:
    - master
    labels:
      preset-dind-enabled: "true"
      preset-kind-volume-mounts: "true"
      preset-azure-community: "true"
    extra_refs:
    - org: kubernetes-sigs
      repo: cluster-api-provider-azure
      base_ref: release-1.17
      path_alias: sigs.k8s.io/cluster-api-provider-azure
      workdir: true
    spec:
      serviceAccountName: azure
      containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
        command:
        - runner.sh
        args:
        - ./scripts/ci-entrypoint.sh
        - bash
        - -c
        - >-
          cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
          make test-ccm-e2e
        securityContext:
          privileged: true
        env:
        - name: TEST_CCM  # CAPZ config
          value: "true"
        - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
          value: "1"
        - name: KUBERNETES_VERSION  # CAPZ config
          value: "latest"
        - name: CLUSTER_TEMPLATE  # CAPZ config
          value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-ci-version-oot-credential-provider.yaml
        - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
          value: "Standard"
        - name: ENABLE_MULTI_SLB  # cloud-provider-azure config
          value: "false"
        - name: PUT_VMSS_VM_BATCH_SIZE  # cloud-provider-azure config
          value: "0"
        - name: LB_BACKEND_POOL_CONFIG_TYPE  # cloud-provider-azure config
          value: "nodeIPConfiguration"
        - name: CUSTOM_CLOUD_PROVIDER_CONFIG  # CAPZ config
          value: "https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cloud-config-vmss-default.json"
        - name: CCM_E2E_ARGS  # cloud-provider-azure config
          value: "-ginkgo.skip=\"\\[Serial\\]\\[Slow\\]|Private\\slink\\sservice|\\[MultipleAgentPools\\]\""
        - name: LABEL_FILTER  # cloud-provider-azure config
          value: "!Serial && !Slow && !PLS && !Multi-Nodepool"
        - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
          value: "capz"
        - name: ENABLE_VMSS_FLEX  # cloud-provider-azure config
          value: "false"
        - name: HEALTH_PROBE_MODE
          value: "shared"
        resources:
          limits:
            cpu: 4
            memory: 9Gi
          requests:
            cpu: 4
            memory: 9Gi
    annotations:
      testgrid-dashboards: provider-azure-cloud-provider-azure
      testgrid-tab-name: pr-cloud-provider-azure-e2e-ccm-vmss-shared-probe-capz
      description: "Runs Azure specific e2e tests with cloud controller manager and shared health probe."
      testgrid-num-columns-recent: '30'
periodics:
- cron: '0 16 * * *'  # Run at 16:00 UTC everyday
  # cloud-provider-azure-master-ipv6-capz runs Azure specific tests periodically using a stable capz release in an IPv6 single stack cluster.
  name: cloud-provider-azure-master-ipv6-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest-1.28"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-ci-version-ipv6.yaml
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-ipv6-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release in an IPv6 single stack cluster."
- cron: '0 16 * * *'  # Run at 16:00 UTC everyday
  # cloud-provider-azure-master-ipv6--vmss-capz runs Azure specific tests periodically using a stable capz release in an IPv6 single stack cluster with VMSS.
  name: cloud-provider-azure-master-ipv6-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cluster-template-prow-ipv6-mp.yaml
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-ipv6-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release in an IPv6 single stack cluster with vmss."
- cron: '0 20 * * *'  # Run at 20:00 UTC everyday
  # cloud-provider-azure-master-dualstack-capz runs Azure specific tests periodically using a stable capz release in a dualstack cluster.
  name: cloud-provider-azure-master-dualstack-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest-1.28"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-ci-version-dual-stack.yaml
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-dualstack-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release in a dualstack cluster."
- cron: '0 20 * * *'  # Run at 20:00 UTC everyday
  # cloud-provider-azure-master-dualstack-vmss-capz runs Azure specific tests periodically using a stable capz release in a dualstack cluster with VMSS.
  name: cloud-provider-azure-master-dualstack-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/cluster-template-prow-dual-stack-mp.yaml
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-dualstack-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release in a dualstack cluster with vmss."
- cron: '0 16 * * *'  # Run at 16:00 UTC everyday
  # cloud-provider-azure-master-capz runs Azure specific tests periodically using a stable capz release.
  name: cloud-provider-azure-master-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using a stable capz release."
- cron: '0 16 * * *'  # Run at 16:00 UTC everyday
  # cloud-provider-azure-master-capz runs Azure specific tests periodically using capz:main.
  name: cloud-provider-azure-master-capz-main
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: main
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-capz-main
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) using capz:main."
- cron: '0 16 * * *'  # Run at 16:00 UTC everyday
  name: cloud-provider-azure-ccm-windows-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: TEST_WINDOWS  # CAPZ config
        value: "true"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: WORKER_MACHINE_COUNT  # CAPZ config
        value: "0"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-ccm-windows-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "[Windows] Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- cron: '0 17 * * *'  # Run at 17:00 UTC everyday
  # cloud-provider-azure-conformance-capz runs Kubernetes conformance tests periodically.
  name: cloud-provider-azure-conformance-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\]|Should.be.able.to.support.the.1\.17.Sample.API.Server.using.the.current.Aggregator --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "30"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- cron: '0 17 * * *'  # Run at 17:00 UTC everyday
  name: cloud-provider-azure-conformance-windows-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\]|\[LinuxOnly\]|Should.be.able.to.support.the.1\.17.Sample.API.Server.using.the.current.Aggregator --node-os-distro=windows --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: TEST_WINDOWS  # CAPZ config
        value: "true"
      - name: WORKER_MACHINE_COUNT  # CAPZ config
        value: "0"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "3"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-windows-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "[Windows] Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- cron: '0 17 * * *'  # Run at 17:00 UTC everyday
  # cloud-provider-azure-slow-capz runs Kubernetes slow tests periodically.
  name: cloud-provider-azure-slow-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "standard"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        value: --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|In-tree.Volumes --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "4"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-slow-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure)."
- cron: '0 18 * * *'  # Run at 18:00 UTC everyday
  # cloud-provider-azure-master-vmss-capz runs Azure specific tests periodically using a stable capz release on vmss.
  name: cloud-provider-azure-master-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-ccm-e2e
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-machine-pool-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "Standard"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-master-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss using a stable capz release."
- cron: '0 18 * * *'  # Run at 18:00 UTC everyday
  # cloud-provider-azure-conformance-vmss-capz runs Kubernetes conformance tests periodically on vmss.
  name: cloud-provider-azure-conformance-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        value: --ginkgo.focus=\[Conformance\]|\[NodeConformance\] --ginkgo.skip=\[Slow\]|\[Serial\]|\[Flaky\]|Should.be.able.to.support.the.1\.17.Sample.API.Server.using.the.current.Aggregator --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-machine-pool-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "Standard"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "30"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
- cron: '0 19 * * *'  # Run at 19:00 UTC everyday
  # cloud-provider-azure-conformance-serial-vmss-capz runs Kubernetes conformance serial tests periodically on vmss.
  name: cloud-provider-azure-conformance-serial-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        # Check https://github.com/kubernetes-sigs/cloud-provider-azure/issues/224 for the status of each skipped test
        value: --ginkgo.focus=\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\]|regular.resource.usage.tracking.resource.tracking.for|validates.MaxPods.limit.number.of.pods.that.are.allowed.to.run|In-tree.Volumes|RuntimeClass.should.run.a.Pod.requesting.a.RuntimeClass.with.scheduling.with.taints|Multi-AZ.Clusters.should.spread.the.pods.of.a.replication.controller.across.zones|Multi-AZ.Clusters.should.spread.the.pods.of.a.service.across.zones|Should.test.that.pv.used.in.a.pod.that.is.deleted.while.the.kubelet.is.down.cleans.up.when.the.kubelet.returns|Should.test.that.pv.used.in.a.pod.that.is.force.deleted.while.the.kubelet.is.down.cleans.up.when.the.kubelet.returns|Should.test.that.pv.written.before.kubelet.restart.is.readable.after.restart|subPath.should.unmount.if.pod.is.force.deleted.while.kubelet.is.down|subPath.should.unmount.if.pod.is.gracefully.deleted.while.kubelet.is.down|Should.test.that.pv.written.before.kubelet.restart.is.readable.after.restart|Kube-proxy.should.recover.after.being.killed.accidentally|Kubelet.should.not.restart.containers.across.restart --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-machine-pool-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "Standard"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "1"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-serial-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes serial conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
- cron: '0 19 * * *'  # Run at 19:00 UTC everyday
  # cloud-provider-azure-conformance-multiple-zones-vmss-capz runs Kubernetes conformance tests periodically on vmss multiple zones.
  name: cloud-provider-azure-conformance-multiple-zones-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        # Check https://github.com/kubernetes-sigs/cloud-provider-azure/issues/224 for the status of each skipped test
        value: --ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|Delete.Grace.Period|runs.ReplicaSets.to.verify.preemption.running.path|client.go.should.negotiate|should.contain.custom.columns.for.each.resource|Network.should.set.TCP.CLOSE_WAIT.timeout|PodSecurityPolicy|In-tree.Volumes|ephemeral.should.support.expansion.of.pvcs.created.for.ephemeral.pvcs|Should.be.able.to.support.the.1\.17.Sample.API.Server.using.the.current.Aggregator --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: WORKER_MACHINE_COUNT  # CAZP config
        value: "3"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cloud-provider-azure/master/tests/k8s-azure/manifest/cluster-api/linux-vmss-multiple-zones-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "Standard"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "30"
      - name: K8S_FEATURE_GATES  # CAPZ config
        value: "ServiceTrafficDistribution=true"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-conformance-multiple-zones-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss multiple zones."
- cron: '0 19 * * *'  # Run at 19:00 UTC everyday
  # cloud-provider-azure-slow-vmss-capz runs Kubernetes slow tests periodically.
  name: cloud-provider-azure-slow-vmss-capz
  cluster: eks-prow-build-cluster
  decorate: true
  decoration_config:
    timeout: 5h
  labels:
    preset-dind-enabled: "true"
    preset-kind-volume-mounts: "true"
    preset-azure-community: "true"
  extra_refs:
  - org: kubernetes-sigs
    repo: cluster-api-provider-azure
    base_ref: release-1.17
    path_alias: sigs.k8s.io/cluster-api-provider-azure
    workdir: true
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: false
  - org: kubernetes-sigs
    repo: cloud-provider-azure
    base_ref: master
    path_alias: sigs.k8s.io/cloud-provider-azure
    workdir: false
  spec:
    serviceAccountName: azure
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
      command:
      - runner.sh
      args:
      - ./scripts/ci-entrypoint.sh
      - bash
      - -c
      - >-
        cp ./kubeconfig ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure/kubeconfig &&
        cd ${GOPATH}/src/sigs.k8s.io/cloud-provider-azure &&
        make test-e2e-capz
      securityContext:
        privileged: true
      env:
      - name: TEST_CCM  # CAPZ config
        value: "true"
      - name: KUBERNETES_VERSION  # CAPZ config
        value: "latest"
      - name: GINKGO_ARGS  # cloud-provider-azure config
        value: --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|In-tree.Volumes --report-dir=/logs/artifacts --disable-log-dump=true
      - name: CONTROL_PLANE_MACHINE_COUNT  # CAPZ config
        value: "1"
      - name: CLUSTER_TEMPLATE  # CAPZ config
        value: https://raw.githubusercontent.com/kubernetes-sigs/cluster-api-provider-azure/release-1.17/templates/test/ci/cluster-template-prow-machine-pool-ci-version.yaml
      - name: AZURE_LOADBALANCER_SKU  # cloud-provider-azure config
        value: "Standard"
      - name: CLUSTER_PROVISIONING_TOOL  # cloud-provider-azure config
        value: "capz"
      - name: GINKGO_PARALLEL_NODES  # cloud-provider-azure config
        value: "30"
      resources:
        limits:
          cpu: 4
          memory: 9Gi
        requests:
          cpu: 4
          memory: 9Gi
  annotations:
    testgrid-dashboards: provider-azure-cloud-provider-azure
    testgrid-tab-name: cloud-provider-azure-slow-vmss-capz
    testgrid-alert-email: kubernetes-provider-azure-oot@googlegroups.com
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes-sigs/cloud-provider-azure) on vmss."
