postsubmits:
  kubernetes-sigs/node-feature-discovery:
  - name: postsubmit-node-feature-discovery-e2e-test
    branches:
    - ^main$
    - ^master$
    max_concurrency: 1
    decorate: true
    annotations:
      testgrid-dashboards: sig-node-node-feature-discovery
      testgrid-tab-name: e2e-test-image
      description: "Run end-to-end tests for node-feature-discovery after merging a pull request"
      testgrid-alert-email: markus.lehtonen@intel.com,feruzjon.muyassarov@intel.com
    spec:
      containers:
      - image: golang:1.20
        command:
        - bash
        args:
        - -c
        - apt update && apt install -y jq && scripts/test-infra/test-e2e.sh
        env:
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: node-feature-discovery-ci
              key: aws-access-key-id
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: node-feature-discovery-ci
              key: aws-secret-access-key
        - name: AWS_REGION
          value: "eu-west-1"
        - name: IMAGE_REGISTRY
          value: gcr.io/k8s-staging-nfd
        - name: KUBECONFIG_DATA
          value: '{"apiVersion":"v1","clusters":[{"cluster":{"certificate-authority-data":"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeU1EWXpNREEzTURjek1sb1hEVE15TURZeU56QTNNRGN6TWxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS1krClQzaWREc2E4L1Z4RkRxREEzRWFzSEk1VTFYcWZmZFhVb25qTXFxeDJpM21WcGNLa1dhTGdwcVZoZ3YzdlJPbi8KVlltcVlYRUNaOTBEOHhKMGFIbTMrMElmekJJRkJSdTY5UWRmUSs2ZXVlUldZVzh3YnVVYjdnZzdyNXQreHZYNApQSFNvMVFSQ001dWw5dFJrd2w3Rm5wcVc0dW5mYnUxaERMdGNzeTMrZkM2eHBDVi9RUVpuQ0ZsbjhkUTQ0cUZICkZNd3NLd1AyZkxpU0FveHRNT3c4TGlpSkk5QWhEb3BIUXNOOEVJQkpHSGN0dDYyb1c2aklKUmhRelFpTnIyaFgKalZ6OFBaVGN0YVZNR1pNbzJFVllaMlIwYTZuSmcyOGVtRUJNL1MyemtBYmoxR3kwUitHanVwRmQ3RGRaUkRFaApHaVpXZXFnNUpyU1lLTWtJejBVQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZPUE5QODJJcFQ2OW1GQkg5QWwwTVNEbStNVDZNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQlhhUHIvenpyMXNjZFgyMFB3Rwo0bWxZQVhpRkdCUkYrQndyWVNTOEVRR2NMVXo5eHhUNEZ1aUQ5MmNBcDQvWTlPWG5DTEFvYkNBN0x2QTN0elpMCm9lUE01U1Jyb1Q3MythZzJ0RHBuWDEyeFB6aEpGTzArVkhGeENSMkhTOHArY1F0eC94Ym1MRTZMbzNJS3dMSisKVEVTT1F3cUNHSmxNNHNiVk9jU0ZGeFRzUURid1hpblVyN1ZqSm03UW9LVHEvcGIwWjU3Q3NlWXYzd1VTYXdWVAo3aXVVdHBMWmhrMDdxZ09XYzFNTzFoNlUyU3BNbkY1akVnSXNmSlByRUJic3RkME55STZFN0FBRzNOSGZOczJlCitHNEhDS0tRdkc0emJkdmFwWjJOSVRaM0NJaml4b0lGOXNDb3pDYWVWV0lCT0xib2lhcVp3M3hyOTZtdnlNNWIKZkNvPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==","server":"https://1AF488C80378BE347035F6704C6F0C8F.gr7.eu-west-1.eks.amazonaws.com"},"name":"aws"}],"contexts":[{"context":{"cluster":"aws","user":"prow"},"name":"aws"}],"current-context":"aws","kind":"Config","preferences":{},"users":[{"name":"prow","user":{"exec":{"apiVersion":"client.authentication.k8s.io/v1","args":["token","-i","nfd-e2e"],"command":"aws-iam-authenticator","interactiveMode":"Never"}}}]}'
        - name: E2E_TEST_CONFIG_DATA
          value: '{"kubelet":{"configPath":"/etc/kubernetes/kubelet/kubelet-config.json"},"defaultFeatures":{"labelWhitelist":["feature.node.kubernetes.io/cpu-cpuid.ADX","feature.node.kubernetes.io/cpu-cpuid.AESNI","feature.node.kubernetes.io/cpu-cpuid.AMXBF16D","feature.node.kubernetes.io/cpu-cpuid.AMXINT8","feature.node.kubernetes.io/cpu-cpuid.AMXTILE","feature.node.kubernetes.io/cpu-cpuid.AVX","feature.node.kubernetes.io/cpu-cpuid.AVX2","feature.node.kubernetes.io/cpu-cpuid.AVX512BF16","feature.node.kubernetes.io/cpu-cpuid.AVX512BITALG","feature.node.kubernetes.io/cpu-cpuid.AVX512BW","feature.node.kubernetes.io/cpu-cpuid.AVX512CD","feature.node.kubernetes.io/cpu-cpuid.AVX512DQ","feature.node.kubernetes.io/cpu-cpuid.AVX512ER","feature.node.kubernetes.io/cpu-cpuid.AVX512F","feature.node.kubernetes.io/cpu-cpuid.AVX512FP16","feature.node.kubernetes.io/cpu-cpuid.AVX512IFMA","feature.node.kubernetes.io/cpu-cpuid.AVX512PF","feature.node.kubernetes.io/cpu-cpuid.AVX512VBMI","feature.node.kubernetes.io/cpu-cpuid.AVX512VBMI2","feature.node.kubernetes.io/cpu-cpuid.AVX512VL","feature.node.kubernetes.io/cpu-cpuid.AVX512VNNI","feature.node.kubernetes.io/cpu-cpuid.AVX512VP2INTERSECT","feature.node.kubernetes.io/cpu-cpuid.AVX512VPOPCNTDQ","feature.node.kubernetes.io/cpu-cpuid.ENQCMD","feature.node.kubernetes.io/cpu-cpuid.FMA3","feature.node.kubernetes.io/cpu-cpuid.GFNI","feature.node.kubernetes.io/cpu-cpuid.HLE","feature.node.kubernetes.io/cpu-cpuid.HYPERVISOR","feature.node.kubernetes.io/cpu-cpuid.IBPB","feature.node.kubernetes.io/cpu-cpuid.MPX","feature.node.kubernetes.io/cpu-cpuid.PCONFIG","feature.node.kubernetes.io/cpu-cpuid.RTM","feature.node.kubernetes.io/cpu-cpuid.SHA","feature.node.kubernetes.io/cpu-cpuid.STIBP","feature.node.kubernetes.io/cpu-cpuid.TME","feature.node.kubernetes.io/cpu-cpuid.VAES","feature.node.kubernetes.io/cpu-cpuid.VMX","feature.node.kubernetes.io/cpu-cpuid.VPCLMULQDQ","feature.node.kubernetes.io/cpu-cstate.enabled","feature.node.kubernetes.io/cpu-hardware_multithreading","feature.node.kubernetes.io/cpu-model.family","feature.node.kubernetes.io/cpu-model.id","feature.node.kubernetes.io/cpu-model.vendor_id","feature.node.kubernetes.io/cpu-power.sst_bf.enabled","feature.node.kubernetes.io/cpu-pstate.status","feature.node.kubernetes.io/cpu-pstate.scaling_governor","feature.node.kubernetes.io/cpu-pstate.turbo","feature.node.kubernetes.io/cpu-rdt.RDTCMT","feature.node.kubernetes.io/cpu-rdt.RDTL3CA","feature.node.kubernetes.io/cpu-rdt.RDTMBA","feature.node.kubernetes.io/cpu-rdt.RDTMBM","feature.node.kubernetes.io/cpu-rdt.RDTMON","feature.node.kubernetes.io/iommu-enabled","feature.node.kubernetes.io/kernel-config.NO_HZ","feature.node.kubernetes.io/kernel-config.NO_HZ_FULL","feature.node.kubernetes.io/kernel-config.NO_HZ_IDLE","feature.node.kubernetes.io/kernel-config.PREEMPT","feature.node.kubernetes.io/kernel-selinux.enabled","feature.node.kubernetes.io/kernel-version.full","feature.node.kubernetes.io/kernel-version.major","feature.node.kubernetes.io/kernel-version.minor","feature.node.kubernetes.io/kernel-version.revision","feature.node.kubernetes.io/memory-numa","feature.node.kubernetes.io/memory-nv.dax","feature.node.kubernetes.io/memory-nv.present","feature.node.kubernetes.io/network-sriov.capable","feature.node.kubernetes.io/network-sriov.configured","feature.node.kubernetes.io/pci-0300_1a03.present","feature.node.kubernetes.io/storage-nonrotationaldisk","feature.node.kubernetes.io/system-os_release.ID","feature.node.kubernetes.io/system-os_release.VERSION_ID","feature.node.kubernetes.io/system-os_release.VERSION_ID.major","feature.node.kubernetes.io/system-os_release.VERSION_ID.minor"],"annotationWhitelist":["nfd.node.kubernetes.io/worker.version","nfd.node.kubernetes.io/feature-labels"],"nodes":[{"name":"oddball","nodeNameRegexp":"5-208","expectedLabelValues":{"feature.node.kubernetes.io/cpu-cpuid.ADX":"true","feature.node.kubernetes.io/cpu-cpuid.AESNI":"true","feature.node.kubernetes.io/cpu-cpuid.AVX":"true","feature.node.kubernetes.io/cpu-cpuid.AVX2":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512BW":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512CD":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512DQ":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512F":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512VL":"true","feature.node.kubernetes.io/cpu-cpuid.FMA3":"true","feature.node.kubernetes.io/cpu-cpuid.HLE":"true","feature.node.kubernetes.io/cpu-cpuid.HYPERVISOR":"true","feature.node.kubernetes.io/cpu-cpuid.MPX":"true","feature.node.kubernetes.io/cpu-cpuid.RTM":"true","feature.node.kubernetes.io/cpu-hardware_multithreading":"true","feature.node.kubernetes.io/cpu-model.family":"6","feature.node.kubernetes.io/cpu-model.id":"85","feature.node.kubernetes.io/cpu-model.vendor_id":"Intel","feature.node.kubernetes.io/kernel-config.NO_HZ":"true","feature.node.kubernetes.io/kernel-config.NO_HZ_IDLE":"true","feature.node.kubernetes.io/kernel-version.major":"5","feature.node.kubernetes.io/pci-0300_1d0f.present":"true","feature.node.kubernetes.io/storage-nonrotationaldisk":"true","feature.node.kubernetes.io/system-os_release.ID":"amzn","feature.node.kubernetes.io/system-os_release.VERSION_ID.major":"2"},"expectedLabelKeys":["feature.node.kubernetes.io/kernel-version.full","feature.node.kubernetes.io/kernel-version.major","feature.node.kubernetes.io/kernel-version.minor","feature.node.kubernetes.io/kernel-version.revision","feature.node.kubernetes.io/system-os_release.VERSION_ID"],"expectedAnnotationKeys":["nfd.node.kubernetes.io/worker.version","nfd.node.kubernetes.io/feature-labels"]},{"name":"default","nodeNameRegexp":".","expectedLabelValues":{"feature.node.kubernetes.io/cpu-cpuid.ADX":"true","feature.node.kubernetes.io/cpu-cpuid.AESNI":"true","feature.node.kubernetes.io/cpu-cpuid.AVX":"true","feature.node.kubernetes.io/cpu-cpuid.AVX2":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512BW":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512CD":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512DQ":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512F":"true","feature.node.kubernetes.io/cpu-cpuid.AVX512VL":"true","feature.node.kubernetes.io/cpu-cpuid.FMA3":"true","feature.node.kubernetes.io/cpu-cpuid.HYPERVISOR":"true","feature.node.kubernetes.io/cpu-cpuid.MPX":"true","feature.node.kubernetes.io/cpu-hardware_multithreading":"true","feature.node.kubernetes.io/cpu-model.family":"6","feature.node.kubernetes.io/cpu-model.id":"85","feature.node.kubernetes.io/cpu-model.vendor_id":"Intel","feature.node.kubernetes.io/kernel-config.NO_HZ":"true","feature.node.kubernetes.io/kernel-config.NO_HZ_IDLE":"true","feature.node.kubernetes.io/kernel-version.major":"5","feature.node.kubernetes.io/pci-0300_1d0f.present":"true","feature.node.kubernetes.io/storage-nonrotationaldisk":"true","feature.node.kubernetes.io/system-os_release.ID":"amzn","feature.node.kubernetes.io/system-os_release.VERSION_ID.major":"2"},"expectedLabelKeys":["feature.node.kubernetes.io/kernel-version.full","feature.node.kubernetes.io/kernel-version.major","feature.node.kubernetes.io/kernel-version.minor","feature.node.kubernetes.io/kernel-version.revision","feature.node.kubernetes.io/system-os_release.VERSION_ID"],"expectedAnnotationKeys":["nfd.node.kubernetes.io/worker.version","nfd.node.kubernetes.io/feature-labels"]}]}}'
