presubmits:
  kubernetes-sigs/kjob:
    - name: pull-kjob-verify-main
      cluster: eks-prow-build-cluster
      branches:
        - ^main
      skip_if_only_changed: "^docs/|^\\.github/|^(README|LICENSE|OWNERS)$"
      decorate: true
      path_alias: sigs.k8s.io/kjob
      annotations:
        testgrid-dashboards: sig-apps
        testgrid-tab-name: pull-kjob-verify-main
        description: "Run kjob verify checks"
      labels:
        preset-dind-enabled: "true"
      spec:
        containers:
          - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
            securityContext:
              privileged: true
            command:
              - runner.sh
            args:
              - make
              - verify
            env:
              - name: GOMAXPROCS
                value: "2"
            resources:
              requests:
                cpu: "2"
                memory: "4Gi"
              limits:
                cpu: "2"
                memory: "4Gi"
    - name: pull-kjob-test-unit-main
      cluster: eks-prow-build-cluster
      branches:
        - ^main
      skip_if_only_changed: "^docs/|^\\.github/|\\.(md)$|^(README|LICENSE|OWNERS)$/"
      decorate: true
      path_alias: sigs.k8s.io/kjob
      annotations:
        testgrid-dashboards: sig-apps
        testgrid-tab-name: pull-kjob-test-unit-main
        description: "Run kjob unit tests"
      spec:
        containers:
          - image: public.ecr.aws/docker/library/golang:1.23
            env:
              - name: GO_TEST_FLAGS
                value: "-race -count 3"
              - name: GOMAXPROCS
                value: "2"
            command:
              - make
            args:
              - test-unit
            resources:
              requests:
                cpu: "2"
                memory: "4Gi"
              limits:
                cpu: "2"
                memory: "4Gi"
    - name: pull-kjob-test-integration-main
      cluster: eks-prow-build-cluster
      branches:
        - ^main
      skip_if_only_changed: "^docs/|^\\.github/|\\.(md)$|^(README|LICENSE|OWNERS)$"
      decorate: true
      path_alias: sigs.k8s.io/kjob
      annotations:
        testgrid-dashboards: sig-apps
        testgrid-tab-name: pull-kjob-test-integration-main
        description: "Run kjob test-integration"
      spec:
        containers:
          - image: public.ecr.aws/docker/library/golang:1.23
            command:
              - make
            args:
              - test-integration
            env:
              - name: GOMAXPROCS
                value: "2"
            resources:
              requests:
                cpu: "2"
                memory: "4Gi"
              limits:
                cpu: "2"
                memory: "4Gi"
    - name: pull-kjob-test-e2e-main
      cluster: eks-prow-build-cluster
      branches:
        - ^main
      skip_if_only_changed: "^docs/|^\\.github/|\\.(md)$|^(README|LICENSE|OWNERS)$"
      decorate: true
      path_alias: sigs.k8s.io/kjob
      annotations:
        testgrid-dashboards: sig-apps
        testgrid-tab-name: pull-kjob-test-e2e-main
        description: "Run kjob end to end tests"
      labels:
        preset-dind-enabled: "true"
      spec:
        containers:
          - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241230-3006692a6f-master
            env:
              - name: E2E_KIND_VERSION
                value: kindest/node:v1.31.2
              - name: BUILDER_IMAGE
                value: public.ecr.aws/docker/library/golang:1.23
            command:
              # generic runner script, handles DIND, bazelrc for caching, etc.
              - runner.sh
            args:
              - make
              - test-e2e
            # docker-in-docker needs privileged mode
            securityContext:
              privileged: true
            resources:
              requests:
                cpu: "2"
                memory: "4Gi"
              limits:
                cpu: "2"
                memory: "4Gi"
