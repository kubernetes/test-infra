presets:
- labels:
    preset-cloudprovider-azure-cred: "true"
  env:
  - name: AZURE_CREDENTIALS
    value: /etc/azure-cred/credentials
  - name: AZURE_SSH_PUBLIC_KEY_FILE
    value: /etc/azure-ssh/azure-ssh-pub
  - name: REGISTRY
    value: k8sprow.azurecr.io
  - name: KUBE_VERBOSE
    value: 0
  volumes:
  - name: azure-cred
    secret:
      secretName: azure-cred
  - name: azure-ssh
    secret:
      secretName: azure-ssh
  volumeMounts:
  - name: azure-cred
    mountPath: /etc/azure-cred
    readOnly: true
  - name: azure-ssh
    mountPath: /etc/azure-ssh
    readOnly: true

presubmits:
  kubernetes/cloud-provider-azure:
  - name: pull-cloud-provider-azure-check
    always_run: true
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - --scenario=execute
        - --
        - make
        - test-check

  # pull-cloud-provider-azure-e2e runs kubernetes conformance tests.
    annotations:
      testgrid-dashboards: sig-azure-master
      testgrid-tab-name: pr-cloud-provider-check
      description: "Run lint check tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-e2e
    # Disable always_run because of https://github.com/kubernetes/test-infra/pull/11887
    # TODO(feiskyer): enable the tests after it's fixed and published in the image
    always_run: false
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-cloudprovider-azure-cred: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/kubernetes=v1.15.0"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--service-account=/etc/service-account/service-account.json"
        - "--timeout=450"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--scenario=kubernetes_e2e"
        - --
        - "--gce-ssh="
        - "--test=true"
        - "--up=true"
        - "--down=true"
        - "--deployment=acsengine"
        - "--build=bazel"
        - "--provider=skeleton"
        - "--ginkgo-parallel=30"
        - "--acsengine-agentpoolcount=2"
        - "--acsengine-admin-username=azureuser"
        - "--acsengine-creds=$AZURE_CREDENTIALS"
        - "--acsengine-orchestratorRelease=1.15"
        - "--acsengine-mastervmsize=Standard_DS2_v2"
        - "--acsengine-agentvmsize=Standard_D4s_v3"
        - "--acsengine-ccm=True"
        - "--acsengine-hyperkube=True"
        - "--acsengine-location=eastus2"
        - "--acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE"
        - "--acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux.json"
        - "--acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz"
        - "--test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\\[Conformance\\] --ginkgo.skip=\\[Serial\\]|\\[sig-node\\]\\sMount\\spropagation|\\[sig-network\\]\\sNetwork\\sshould\\sset\\sTCP\\sCLOSE_WAIT\\stimeout|\\[sig-storage\\]\\sPersistentVolumes-local\\sStress\\swith\\slocal\\svolume\\sprovisioner\\s\\[Serial\\]\\sshould\\suse\\sbe\\sable\\sto\\sprocess\\smany\\spods\\sand\\sreuse\\slocal\\svolumes|should\\sunmount\\sif\\spod\\sis\\sgracefully\\sdeleted\\swhile\\skubelet\\sis\\sdown\\s\\[Disruptive\\]\\[Slow\\]|should\\sunmount\\sif\\spod\\sis\\sforce\\sdeleted\\swhile\\skubelet\\sis\\sdown\\s\\[Disruptive\\]\\[Slow\\]|\\[sig-network\\]\\sServices\\sshould\\sbe\\sable\\sto\\screate\\sa\\sfunctioning\\sNodePort\\sservice|\\[sig-scheduling\\]\\sSchedulerPredicates\\s\\[Serial\\]\\svalidates\\sMaxPods\\slimit\\snumber\\sof\\spods\\sthat\\sare\\sallowed\\sto\\srun\\s\\[Slow\\]|\\[sig-storage\\]\\sDynamic\\sProvisioning\\sDynamicProvisioner\\sDefault\\sshould\\screate\\sand\\sdelete\\sdefault\\spersistent\\svolumes\\s\\[Slow\\]|\\[sig-storage\\]\\sDynamic\\sProvisioning\\sDynamicProvisioner\\sshould\\sprovision\\sstorage\\swith\\sdifferent\\sparameters|\\[sig-storage\\]\\sDynamic\\sProvisioning\\sDynamicProvisioner\\sshould\\stest\\sthat\\sdeleting\\sa\\sclaim\\sbefore\\sthe\\svolume\\sis\\sprovisioned\\sdeletes\\sthe\\svolume.|\\[sig-apps\\]\\sStatefulSet\\s\\[k8s.io\\]\\sBasic\\sStatefulSet\\sfunctionality\\s\\[StatefulSetBasic\\]\\sshould\\sadopt\\smatching\\sorphans\\sand\\srelease\\snon-matching\\spods|\\[sig-apps\\]\\sStatefulSet\\s\\[k8s.io\\]\\sBasic\\sStatefulSet\\sfunctionality\\s\\[StatefulSetBasic\\]\\sshould\\snot\\sdeadlock\\swhen\\sa\\spod.s\\spredecessor\\sfails|\\[sig-apps\\]\\sStatefulSet\\s\\[k8s.io\\]\\sBasic\\sStatefulSet\\sfunctionality\\s\\[StatefulSetBasic\\]\\sshould\\sperform\\srolling\\supdates\\sand\\sroll\\sbacks\\sof\\stemplate\\smodifications\\swith\\sPVCs|\\[sig-apps\\]\\sStatefulSet\\s\\[k8s.io\\]\\sBasic\\sStatefulSet\\sfunctionality\\s\\[StatefulSetBasic\\]\\sshould\\sprovide\\sbasic\\sidentity|\\[sig-storage\\]\\sPersistentVolumes\\sDefault\\sStorageClass\\spods\\sthat\\suse\\smultiple\\svolumes\\sshould\\sbe\\sreschedulable|\\[sig-storage\\]\\sPVC\\sProtection|\\[sig-storage\\]\\sDynamic\\sProvisioning\\s\\[k8s.io\\]\\sGlusterDynamicProvisioner|\\[sig-storage\\]\\sVolumes\\sAzure\\sDisk\\sshould\\sbe\\smountable\\s\\[Slow\\]|\\[sig-apps\\]\\sNetwork\\sPartition\\s\\[Disruptive\\]\\s\\[Slow\\]|\\[sig-network\\]\\sDNS\\sconfigMap|\\[k8s.io\\]\\s\\[sig-node\\]\\sKubelet\\s\\[Serial\\]\\s\\[Slow\\]\\s\\[k8s.io\\]\\s\\[sig-node\\]\\sregular\\sresource\\susage\\stracking\\sresource\\stracking\\sfor\\s0\\spods\\sper\\snode|\\[k8s.io\\]\\s\\[sig-node\\]\\sKubelet\\s\\[Serial\\]\\s\\[Slow\\]\\s\\[k8s.io\\]\\s\\[sig-node\\]\\sregular\\sresource\\susage\\stracking\\sresource\\stracking\\sfor\\s100\\spods\\sper\\snode|Horizontal\\spod\\sautoscaling\\s\\(scale\\sresource:\\sCPU\\)|\\[sig-storage\\]\\sDynamic\\sProvisioning\\sDynamicProvisioner\\sExternal\\sshould\\slet\\san\\sexternal\\sdynamic\\sprovisioner\\screate\\sand\\sdelete\\spersistent\\svolumes\\s\\[Slow\\]|ESIPP|\\[sig-network\\]\\sServices\\sshould\\spreserve\\ssource\\spod\\sIP\\sfor\\straffic\\sthru\\sservice\\scluster\\sIP|In-tree\\sVolumes|PersistentVolumes-local|CSI\\sVolumes|should\\swrite\\sentries\\sto\\s/etc/hosts|\\[Slow\\]|\\[Serial\\]|\\[Disruptive\\]|\\[Flaky\\]|\\[Feature:.+\\]|\\[NodeFeature:.+\\]|\\[sig-cli\\]\\sKubectl\\sclient\\s\\[k8s\\.io\\]\\sSimple\\spod\\sshould\\ssupport\\sexec\\susing\\sresource\\/name"
        - "--timeout=420m"
        securityContext:
          privileged: true
    annotations:
      testgrid-dashboards: sig-azure-master
      testgrid-tab-name: pr-cloud-provider-e2e
      description: "Run Kubernetes e2e tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
# pull-cloud-provider-azure-e2e-ccm runs Azure specific e2e tests.
  - name: pull-cloud-provider-azure-e2e-ccm
    always_run: true
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-cloudprovider-azure-cred: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/kubernetes=v1.15.0"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--service-account=/etc/service-account/service-account.json"
        - "--timeout=450"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--scenario=kubernetes_e2e"
        - --
        - "--gce-ssh="
        - "--test=true"
        - "--up=true"
        - "--down=true"
        - "--deployment=acsengine"
        - "--build=bazel"
        - "--provider=skeleton"
        - "--ginkgo-parallel=30"
        - "--test-ccm=True"
        - "--acsengine-agentpoolcount=2"
        - "--acsengine-admin-username=azureuser"
        - "--acsengine-creds=$AZURE_CREDENTIALS"
        - "--acsengine-orchestratorRelease=1.15"
        - "--acsengine-mastervmsize=Standard_DS2_v2"
        - "--acsengine-agentvmsize=Standard_D4s_v3"
        - "--acsengine-ccm=True"
        - "--acsengine-location=eastus2"
        - "--acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE"
        - "--acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux.json"
        - "--acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz"
        - "--timeout=420m"
        securityContext:
          privileged: true
    annotations:
      testgrid-dashboards: sig-azure-master
      testgrid-tab-name: pr-cloud-provider-e2e-ccm
      description: "Runs Azure specific tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
      testgrid-num-columns-recent: '30'
  - name: pull-cloud-provider-azure-unit
    always_run: true
    branches:
    - master
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - --scenario=execute
        - --
        - make
        - test-unit
    annotations:
      testgrid-dashboards: sig-azure-master
      testgrid-tab-name: pr-cloud-provider-unit
      description: "Run unit tests for cloud-provider-azure."
      testgrid-num-columns-recent: '30'
periodics:
- interval: 8h
  # ci-cloud-provider-azure-master runs Azure specific tests periodically.
  name: ci-cloud-provider-azure-master
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --test-ccm=True
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-master
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
- interval: 8h
  # ci-cloud-provider-azure-autoscaling runs node autoscaling tests periodically.
  name: ci-cloud-provider-azure-autoscaling
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --test-ccm=True
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-autoscaler.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: CCM_E2E_ARGS
        value: "-ginkgo.focus=autoscaler"
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-autoscaling
    description: "Runs node autoscaling tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
- interval: 8h
  # ci-cloud-provider-azure-conformance runs Kubernetes conformance tests periodically.
  name: ci-cloud-provider-azure-conformance
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\[Conformance\] --ginkgo.skip=\[Serial\]|\[Slow\]
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-conformance
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
- interval: 8h
  # ci-cloud-provider-azure-slow runs Kubernetes slow tests periodically.
  name: ci-cloud-provider-azure-slow
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-slow
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
- interval: 12h
  # ci-cloud-provider-azure-serial runs Kubernetes serial tests periodically.
  name: ci-cloud-provider-azure-serial
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=620
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_D4s_v3
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss-serial.json
      # Skip three kinds of test cases:
      # 1. regular resource usage tracking, haven't found the cause of the failures.
      # 2. DNS config map nameserver, the coredns configmap config in aks-engine is set to reconcile, making it impossible for the newly generated configmap in test cases to overwrite the original one. https://github.com/Azure/aks-engine/blob/master/parts/k8s/addons/coredns.yaml#L59
      # 3. validates MaxPods limit number of pods that are allowed to run, related to issue kubernetes/kubernetes#80177
      # 4. Checks that the node becomes unreachable, the externel IP is unavailable since the corresponding configuration in aks-engine is set to false.
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\]|should\sunmount|When\skubelet\srestarts|regular\sresource\susage\stracking\sresource\stracking\sfor|validates\sMaxPods\slimit\snumber\sof\spods\sthat\sare\sallowed\sto\srun|DNS\sconfigMap\snameserver|Checks\sthat\sthe\snode\sbecomes\sunreachable --minStartupPods=8
      - --timeout=600m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-serial
    description: "Runs Kubernetes serial tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure)."
- interval: 8h
  # ci-cloud-provider-azure-master-vmss runs Azure specific tests periodically on VMSS.
  name: ci-cloud-provider-azure-master-vmss
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --test-ccm=True
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-master-vmss
    description: "Runs Azure specific tests periodically with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure) on VMSS."
- interval: 8h
  # ci-cloud-provider-azure-conformance-vmss runs Kubernetes conformance tests periodically on VMSS.
  name: ci-cloud-provider-azure-conformance-vmss
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\[Conformance\] --ginkgo.skip=\[Serial\]|\[Slow\]
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-conformance-vmss
    description: "Runs Kubernetes conformance tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure) on VMSS."
- interval: 8h
  # ci-cloud-provider-azure-slow-vmss runs Kubernetes slow tests periodically on VMSS.
  name: ci-cloud-provider-azure-slow-vmss
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.focus=\[Slow\] --ginkgo.skip=\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: cloud-provider-azure-slow-vmss
    description: "Runs Kubernetes slow tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure) on VMSS."
- interval: 8h
  # ci-cloud-provider-azure-multiple-zones runs Kubernetes multiple availability zones tests periodically.
  name: ci-cloud-provider-azure-multiple-zones
  labels:
    preset-service-account: "true"
    preset-cloudprovider-azure-cred: "true"
    preset-dind-enabled: "true"
  extra_refs:
  - org: kubernetes
    repo: cloud-provider-azure
    base_ref: master
    path_alias: k8s.io/cloud-provider-azure
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20190806-012cf5f-master
      args:
      - --job=$(JOB_NAME)
      - --repo=k8s.io/kubernetes=v1.15.0
      - --repo=k8s.io/$(REPO_NAME)=master
      - --root=/go/src
      - --service-account=/etc/service-account/service-account.json
      - --timeout=450
      - --upload=gs://kubernetes-jenkins/logs/
      - --scenario=kubernetes_e2e
      - --
      - --gce-ssh=
      - --test=true
      - --up=true
      - --down=true
      - --deployment=acsengine
      - --build=bazel
      - --provider=skeleton
      - --ginkgo-parallel=30
      - --acsengine-agentpoolcount=2
      - --acsengine-admin-username=azureuser
      - --acsengine-creds=$AZURE_CREDENTIALS
      - --acsengine-orchestratorRelease=1.15
      - --acsengine-mastervmsize=Standard_DS2_v2
      - --acsengine-agentvmsize=Standard_D4s_v3
      - --acsengine-ccm=True
      - --acsengine-hyperkube=True
      - --acsengine-location=eastus2
      - --acsengine-public-key=$AZURE_SSH_PUBLIC_KEY_FILE
      - --acsengine-template-url=https://raw.githubusercontent.com/kubernetes/cloud-provider-azure/master/tests/k8s-azure/manifest/linux-vmss-multi-zones.json
      - --acsengine-download-url=https://github.com/Azure/aks-engine/releases/download/v0.37.3/aks-engine-v0.37.3-linux-amd64.tar.gz
      # Four kinds of cases should be skipped:
      # 1. ssh related cases
      # 2. PSP related cases, reason: https://github.com/Azure/aks-engine/blob/master/parts/k8s/addons/kubernetesmasteraddons-pod-security-policy.yaml#L41
      # 3. cases in which PV will be created, for these shall be failed since AzureDisk will be disabled when ccm is enabled
      # 4. cases requiring node's public IP
      - --test_args=--ginkgo.flakeAttempts=2 --num-nodes=2 --ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|Network\sshould\sset\sTCP\sCLOSE_WAIT\stimeout|Mount\spropagation\sshould\spropagate\smounts\sto\sthe\shost|PodSecurityPolicy|PVC\sProtection\sVerify|should\sprovide\sbasic\sidentity|should\sadopt\smatching\sorphans\sand\srelease|should\snot\sdeadlock\swhen\sa\spod's\spredecessor\sfails|should\sperform\srolling\supdates\sand\sroll\sbacks\sof\stemplate\smodifications\swith\sPVCs|should\sperform\srolling\supdates\sand\sroll\sbacks\sof\stemplate\smodifications|Services\sshould\sbe\sable\sto\screate\sa\sfunctioning\sNodePort\sservice$
      - --timeout=420m
      securityContext:
        privileged: true
      env:
      - name: REPO_OWNER
        value: kubernetes
      - name: REPO_NAME
        value: cloud-provider-azure
  annotations:
    testgrid-dashboards: sig-azure-master
    testgrid-tab-name: ci-cloud-provider-azure-multiple-zones
    description: "Runs Kubernetes multiple availability zones tests with cloud-provider-azure (https://github.com/kubernetes/cloud-provider-azure) on VMSS."
