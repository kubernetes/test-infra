periodics:
  - name: ci-k8s-infra-aks-build-cluster
    cron: "*/5 * * * *" #Every 5 minutes
    cluster: k8s-infra-aks-prow-build
    decorate: true
    max_concurrency: 1
    extra_refs:
      - org: kubernetes
        repo: test-infra
        base_ref: master
    annotations:
      testgrid-dashboards: sig-k8s-infra-prow
      testgrid-tab-name: aks-prow-build-heartbeat
      testgrid-num-failures-to-alert: "6"
      testgrid-alert-email: k8s-infra-alerts@kubernetes.io
    spec:
      containers:
        - image: alpine:latest
          command:
            - "echo"
          args:
            - "Everything is fine!"
          resources:
            limits:
              cpu: 100m
              memory: 512Mi
            requests:
              cpu: 100m
              memory: 512Mi
  - name: ci-kubernetes-cross-canary
    cluster: k8s-infra-aks-prow-build
    interval: 2h
    decorate: true
    extra_refs:
      - org: kubernetes
        repo: kubernetes
        base_ref: master
        path_alias: k8s.io/kubernetes
    max_concurrency: 1
    path_alias: k8s.io/kubernetes
    annotations:
      testgrid-dashboards: sig-k8s-infra-canaries
      testgrid-tab-name: ci-k8s-cross-canary
    labels:
      preset-dind-enabled: "true"
    spec:
      containers:
        - image: us-central1-docker.pkg.dev/k8s-staging-test-infra/images/kubekins-e2e:v20260120-e2c483ffe9-master
          command:
            - runner.sh
          args:
            - make
            - release
            - KUBE_RELEASE_RUN_TESTS=n
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            limits:
              cpu: 7
              memory: "25Gi"
            requests:
              cpu: 7
              memory: "25Gi"
  - interval: 1h
    cluster: k8s-infra-aks-prow-build
    name: ci-kubernetes-verify-master-canary
    labels:
      preset-dind-enabled: "true"
    annotations:
      testgrid-dashboards: sig-k8s-infra-canaries
      testgrid-tab-name: verify-master-canary
      description: "Ends up running: make verify on AKS"
    decorate: true
    extra_refs:
      - org: kubernetes
        repo: kubernetes
        base_ref: master
        path_alias: k8s.io/kubernetes
    spec:
      containers:
        - image: us-central1-docker.pkg.dev/k8s-staging-test-infra/images/kubekins-e2e:v20260120-e2c483ffe9-master
          command:
            - runner.sh
          args:
            - ./hack/jenkins/verify-dockerized.sh
          env:
            - name: EXCLUDE_READONLY_PACKAGE
              value: "y"
            - name: KUBE_VERIFY_GIT_BRANCH
              value: master
            - name: REPO_DIR
              value: /workspace/k8s.io/kubernetes
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            limits:
              cpu: 6
              memory: 24Gi
            requests:
              cpu: 6
              memory: 24Gi
  - interval: 4h
    cluster: k8s-infra-aks-prow-build
    name: ci-kubernetes-e2e-kind-ipv6-canary
    annotations:
      testgrid-dashboards: sig-testing-kind
      testgrid-tab-name: kind-ipv6-master-canary
      description: Uses kubetest to run e2e tests for on-by-default features against a latest kubernetes master IPv6 cluster created with sigs.k8s.io/kind
      # testgrid-alert-email: bentheelder@google.com,antonio.ojea.garcia@gmail.com,release-team@kubernetes.io
      testgrid-num-columns-recent: '6'
    labels:
      preset-dind-enabled: "true"
    decorate: true
    decoration_config:
      timeout: 60m
    extra_refs:
    - org: kubernetes
      repo: kubernetes
      base_ref: master
      path_alias: k8s.io/kubernetes
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/k8s-staging-test-infra/images/kubekins-e2e:v20260120-e2c483ffe9-master
        command:
        - runner.sh
        - bash
        - -c
        - curl -sSL https://kind.sigs.k8s.io/dl/latest/linux-amd64.tgz | tar xvfz - -C "${PATH%%:*}/" && e2e-k8s.sh
        env:
        # enable IPV6 in bootstrap image
        - name: DOCKER_IN_DOCKER_IPV6_ENABLED
          value: "true"
        # tell kind CI script to use ipv6
        - name: IP_FAMILY
          value: "ipv6"
        - name: LABEL_FILTER
          value: "Feature: isEmpty && !Slow && !Disruptive && !Flaky"
        - name: PARALLEL
          value: "true"
        # we need privileged mode in order to do docker in docker
        securityContext:
          privileged: true
        resources:
          limits:
            memory: 9Gi
            cpu: 4
          requests:
            # these are both a bit below peak usage during build
            # this is mostly for building kubernetes
            memory: 9Gi
            # during the tests more like 3-20m is used
            cpu: 4
