presets:
- labels:
    preset-e2e-containerd: "true"
  env:
  - name: LOG_DUMP_SYSTEMD_SERVICES
    value: containerd containerd-installation
  - name: KUBE_MASTER_EXTRA_METADATA
    value: user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/env
  - name: KUBE_NODE_EXTRA_METADATA
    value: user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/env
  - name: KUBE_CONTAINER_RUNTIME_ENDPOINT
    value: unix:///run/containerd/containerd.sock
  - name: KUBE_CONTAINER_RUNTIME_NAME
    value: containerd
  - name: NETWORK_PROVIDER
    value: ""
  - name: NON_MASQUERADE_CIDR
    value: 0.0.0.0/0
  - name: KUBELET_TEST_ARGS
    value: --runtime-cgroups=/system.slice/containerd.service --cgroup-driver=systemd
- labels:
    preset-e2e-containerd-image-load: "true"
  env:
  - name: KUBE_LOAD_IMAGE_COMMAND
    value: /home/containerd/usr/local/bin/ctr -n=k8s.io images import
- labels:
    preset-e2e-containerd-image-load-legacy: "true"
  env:
  - name: KUBE_LOAD_IMAGE_COMMAND
    value: /home/containerd/usr/local/bin/ctr cri load
- labels:
    preset-e2e-cos-containerd: "true"
  env:
  - name: LOG_DUMP_SYSTEMD_SERVICES
    value: containerd

periodics:
# containerd build PERIODICS have been moved to the config/jobs/containerd/containerd folder. Please don't add any in here.
- name: ci-containerd-e2e-ubuntu-gce
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
    preset-e2e-containerd-image-load: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --extract=ci/latest
      - --gcp-node-image=ubuntu
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --image-family=ubuntu-2204-lts
      - --image-project=ubuntu-os-cloud
      - --provider=gce
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=50m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: containerd-e2e-ubuntu
- name: ci-cos-cgroupv1-containerd-node-e2e
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/image-config-cgroupv1.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv1-containerd-node-e2e
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
- name: ci-cos-cgroupv1-containerd-node-e2e-features
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/image-config-cgroupv1.yaml
      - --deployment=node
      - --gcp-zone=us-central1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv1-containerd-node-features
- name: ci-cos-cgroupv1-containerd-node-e2e-serial
  cluster: k8s-infra-prow-build
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 260m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/image-config-cgroupv1.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=1 --timeout=4h --focus="\[Serial\]" --skip="\[Flaky\]|\[Benchmark\]|\[NodeSpecialFeature:.+\]|\[NodeSpecialFeature\]|\[NodeAlphaFeature:.+\]|\[NodeAlphaFeature\]|\[NodeFeature:Eviction\]|\[NodeFeature:NodeSwap]"
      - --timeout=240m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv1-containerd-node-e2e-serial
- name: ci-containerd-node-e2e-1-6
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: release-1.25
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: release/1.6
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20231113-7213ea5323-1.25
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-release-1.6/image-config.yaml
      - --deployment=node
      - --gcp-zone=us-central1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: containerd-node-e2e-1.6
- name: ci-containerd-node-e2e-1-7
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: release/1.7
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-release-1.7/image-config.yaml
          - --deployment=node
          - --gcp-zone=us-central1-b
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-driver=systemd --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Serial\]"
          - --timeout=65m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: containerd-node-e2e-1.7
- name: ci-containerd-node-e2e-features-1-6
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: release-1.25
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: release/1.6
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20231113-7213ea5323-1.25
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-release-1.6/image-config.yaml
      - --deployment=node
      - --gcp-zone=us-central1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: containerd-node-e2e-features-1.6
- name: ci-containerd-node-e2e-features-1-7
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: release/1.7
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-release-1.7/image-config.yaml
          - --deployment=node
          - --gcp-zone=us-central1-b
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-driver=systemd --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]"
          - --timeout=65m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: containerd-node-e2e-features-1.7

- name: ci-cri-containerd-e2e-gce-device-plugin-gpu
  cluster: k8s-infra-prow-build
  cron: "30 1-23/3 * * *"
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
    preset-ci-gce-device-plugin-gpu: "true"
    preset-e2e-containerd-image-load: "true"
  decorate: true
  decoration_config:
    timeout: 300m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  spec:
    containers:
    - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --extract=ci/latest
      # Note: The GCE Node image used may have a dependency on the nvidia-driver-installer image defined in https://github.com/kubernetes/kubernetes/blob/master/test/e2e/testing-manifests/scheduling/nvidia-driver-installer.yaml
      # If updating the image defined here, the cos-gpu-installer image may need to updated to support the corresponding COS image.
      - --env=KUBE_GCE_NODE_IMAGE=cos-109-17800-147-22
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: e2e-cos-device-plugin-gpu
    testgrid-num-failures-to-alert: '8'
    testgrid-alert-stale-results-hours: '24'

- name: ci-kubernetes-node-kubelet-containerd-eviction
  cluster: k8s-infra-prow-build
  interval: 4h30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 320m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --deployment=node
      - --gcp-zone=us-west1-b
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-serial-eviction.yaml
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=1 --focus="\[NodeFeature:Eviction\]" --timeout=300m
      - --timeout=300m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-release-blocking
    testgrid-tab-name: node-kubelet-containerd-eviction
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
    description: "Uses kubetest to run node-e2e Eviction tests"

- name: ci-cri-containerd-node-e2e-features
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/image-config.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-driver=systemd --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: node-e2e-features
- name: ci-cri-containerd-node-e2e-unlabelled
  cluster: k8s-infra-prow-build
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 400m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/image-config.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-driver=systemd --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=1 --skip="\[Flaky\]|\[NodeConformance\]|\[Conformance\]|\[Serial\]|\[NodeFeature:.+\]|\[NodeFeature\]|\[Feature:.+\]|\[Feature\]|\[NodeSpecialFeature:.+\]|\[NodeSpecialFeature\]|\[NodeAlphaFeature:.+\]|\[NodeAlphaFeature\]|\[Legacy:.+\]|\[Benchmark\]|\[Feature:SCTPConnectivity\]"
      - --timeout=300m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: node-e2e-unlabelled
    description: "Contains all uncategorized tests, these are tests which are not marked with a [Node] tag. All node tests should be marked with [NodeFeature] or [NodeSpecialFeature] or [NodeAlphaFeature] or [NodeConformance] classification. Also skipped are [Flaky], [Benchmark], [Legacy]."
- interval: 1h
  name: ci-cos-containerd-e2e-cos-gce
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-cos-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  spec:
    containers:
    - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-nodes=4
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --image-family=cos-109-lts
      - --image-project=cos-cloud
      - --provider=gce
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[NodeFeature:RuntimeHandler\] --minStartupPods=8
      - --timeout=50m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: image-validation-cos-e2e
- interval: 1h
  name: ci-cos-containerd-e2e-ubuntu-gce
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-cos-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --extract=ci/latest
      - --gcp-node-image=ubuntu
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --image-family=pipeline-1-29
      - --image-project=ubuntu-os-gke-cloud
      - --provider=gce
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[NodeFeature:RuntimeHandler\] --minStartupPods=8
      - --timeout=50m
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: image-validation-ubuntu-e2e
- name: ci-cos-containerd-node-e2e
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-systemd.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: image-validation-node-e2e
- name: ci-cos-containerd-node-e2e-features
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-systemd.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: image-validation-node-features
- name: ci-cos-cgroupv2-containerd-node-e2e-features
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 200m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/image-config-cgroupv2.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--fail-cgroupv1=true --cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeFeature:.+\]|\[NodeFeature\]" --skip="\[Flaky\]|\[Serial\]|\[NodeFeature:NodeSwap\]"
      - --timeout=65m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv2-containerd-node-features
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
- name: ci-cos-cgroupv2-containerd-node-e2e
  cluster: k8s-infra-prow-build
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 200m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/image-config-cgroupv2.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--fail-cgroupv1=true --cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Slow\]|\[Serial\]|\[NodeFeature:NodeSwap\]"
      - --timeout=180m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv2-containerd-node-e2e
- name: ci-cgroup-systemd-containerd-node-e2e
  cluster: k8s-infra-prow-build
  interval: 1h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/systemd/image-config.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/home/containerd/usr/local/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=8 --focus="\[NodeConformance\]" --skip="\[Flaky\]|\[Serial\]"
      - --timeout=65m
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
      env:
      - name: GOPATH
        value: /go
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cgroup-systemd-containerd-node-e2e
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
- interval: 12h
  name: ci-cos-cgroupv2-containerd-e2e-gce
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --env=ENABLE_POD_SECURITY_POLICY=true
      - --env=KUBE_MASTER_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
      - --env=KUBE_NODE_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
      - --env=KUBELET_TEST_ARGS=--runtime-cgroups=/system.slice/containerd.service --fail-cgroupv1=true --cgroup-driver=systemd
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-nodes=4
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --image-family=cos-stable
      - --image-project=cos-cloud
      - --provider=gce
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[NodeFeature:NodeSwap\] --minStartupPods=8
      - --timeout=50m
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi

  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv2-containerd-e2e
- interval: 12h
  name: ci-cos-cgroupv1-containerd-e2e-gce
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --env=ENABLE_POD_SECURITY_POLICY=true
      - --env=KUBE_MASTER_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/env-cgroupv1
      - --env=KUBE_NODE_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/env-cgroupv1
      - --env=KUBELET_TEST_ARGS=--runtime-cgroups=/system.slice/containerd.service
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-nodes=4
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --image-family=cos-stable
      - --image-project=cos-cloud
      - --provider=gce
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[NodeFeature:NodeSwap\] --minStartupPods=8
      - --timeout=50m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv1-containerd-e2e
- name: ci-cos-cgroupv2-containerd-node-e2e-serial
  cluster: k8s-infra-prow-build
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 260m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/image-config-cgroupv2-serial.yaml
      - --deployment=node
      - --gcp-zone=us-west1-b
      - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=containerd --container-runtime-pid-file= --kubelet-flags="--fail-cgroupv1=true --cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
      - --node-tests=true
      - --provider=gce
      - --test_args=--nodes=1 --timeout=4h --focus="\[Serial\]" --skip="\[Flaky\]|\[Benchmark\]|\[NodeSpecialFeature:.+\]|\[NodeSpecialFeature\]|\[NodeAlphaFeature:.+\]|\[NodeAlphaFeature\]|\[NodeFeature:Eviction\]|\[NodeFeature:NodeSwap\]"
      - --timeout=240m
      env:
      - name: GOPATH
        value: /go
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv2-containerd-node-e2e-serial
- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-containerd
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 70m
  spec:
    containers:
    - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --env=LOG_DUMP_SYSTEMD_SERVICES=containerd
      - --extract=ci/latest
      - --gcp-master-image=gci
      - --gcp-node-image=gci
      - --gcp-nodes=4
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=30
      - --provider=gce
      # [Driver: gcepd] tests are skipped because CSIMigrationGCE is on in 1.23 and can be un-skipped once the cluster-up process
      # uses cloud-provider-gcp. see issue https://github.com/kubernetes/cloud-provider-gcp/issues/293
      - --test_args=--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Driver:.gcepd\]|\[Flaky\]|\[Feature:.+\]|\[NodeFeature:RuntimeHandler\]|\[NodeFeature:NodeSwap\] --minStartupPods=8
      - --timeout=50m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: google-gce, sig-storage-kubernetes
    testgrid-tab-name: gce-containerd
    description: node gce e2e tests for master branch using containerd
- name: ci-kubernetes-node-kubelet-containerd-resource-managers
  interval: 4h
  cluster: k8s-infra-prow-build
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 120m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-serial-resource-managers.yaml
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=1 --focus="\[Feature:CPUManager\]|\[Feature:MemoryManager\]|\[Feature:TopologyManager\]"
          - --timeout=90m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: node-kubelet-containerd-resource-managers
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
    description: "Executes CPU, Memory and Topology manager e2e tests"
- name: ci-kubernetes-node-kubelet-containerd-hugepages
  cluster: k8s-infra-prow-build
  interval: 4h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 120m
  extra_refs:
    - org: kubernetes
      repo: kubernetes
      base_ref: master
      path_alias: k8s.io/kubernetes
      workdir: true
    - org: kubernetes
      repo: test-infra
      base_ref: master
      path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
          - runner.sh
          - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-serial-hugepages.yaml
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=1 --focus="\[Feature:HugePages\]"
          - --timeout=90m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: node-kubelet-containerd-hugepages
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
    description: "Executes hugepages e2e tests"

- name: ci-kubernetes-node-swap-ubuntu
  cluster: k8s-infra-prow-build
  interval: 4h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 240m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/swap/image-config-swap.yaml
          - --env=KUBE_MASTER_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
          - --env=KUBE_NODE_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
          - '--node-test-args=--feature-gates="NodeSwap=true" --service-feature-gates="NodeSwap=true" --container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --feature-gates=NodeSwap=true --kubelet-flags="--cgroups-per-qos=true --cgroup-root=/ --fail-swap-on=false --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=8 --focus="\[NodeConformance\]|\[NodeFeature:.+\]" --skip="\[Flaky\]|\[Slow\]|\[Serial\]"
          - --timeout=180m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-kubelet
    testgrid-tab-name: kubelet-gce-e2e-swap-ubuntu
    testgrid-alert-email: ehashman@redhat.com, mkmir@google.com
    description: Executes E2E suite with swap enabled on Ubuntu
- name: ci-kubernetes-node-kubelet-containerd-performance-test
  cluster: k8s-infra-prow-build
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 90m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
          - runner.sh
          - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/perf-image-config.yaml
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroups-per-qos=true --cgroup-driver=systemd --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}" --server-start-timeout=420s'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=1 --focus="Node Performance Testing"
          - --timeout=60m
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 8Gi
          requests:
            cpu: 4
            memory: 8Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: node-kubelet-containerd-performance-test
    testgrid-alert-email: kubernetes-sig-node-test-failures@googlegroups.com
    description: "Executes performance e2e tests"
- name: ci-kubernetes-node-kubelet-lock-contention
  cluster: k8s-infra-prow-build
  interval: 4h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 240m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-systemd.yaml
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service --lock-file=/var/run/kubelet.lock --exit-on-lock-contention=true" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=1 --focus="\[NodeSpecialFeature:LockContention\]" --skip="\[Flaky\]|\[Serial\]"
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-kubelet
    testgrid-tab-name: kubelet-gce-e2e-lock-contention
    description: "Contains disruptive tests for the Lock Contention feature."
- name: ci-kubernetes-node-kubelet-credential-provider
  cluster: k8s-infra-prow-build
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 240m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
      - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        command:
          - runner.sh
          - /workspace/scenarios/kubernetes_e2e.py
        args:
          - --deployment=node
          - --gcp-zone=us-west1-b
          - --node-args=--image-config-file=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/image-config-systemd.yaml
          - '--node-test-args=--container-runtime-endpoint=unix:///run/containerd/containerd.sock --container-runtime-process-name=/usr/bin/containerd --container-runtime-pid-file= --kubelet-flags="--feature-gates=DisableKubeletCloudCredentialProviders=true --cgroup-driver=systemd --cgroups-per-qos=true --cgroup-root=/ --runtime-cgroups=/system.slice/containerd.service" --extra-log="{\"name\": \"containerd.log\", \"journalctl\": [\"-u\", \"containerd*\"]}"'
          - --node-tests=true
          - --provider=gce
          - --test_args=--nodes=1 --focus="\[Feature:KubeletCredentialProviders\]" --skip="\[Flaky\]|\[Serial\]"
        env:
          - name: GOPATH
            value: /go
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-kubelet
    testgrid-tab-name: kubelet-credential-provider
    description: "tests feature kubelet image credential provider"
- name: ci-kubernetes-e2e-gcp-credential-provider
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  decorate: true
  decoration_config:
    timeout: 240m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  spec:
    containers:
      - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
        args:
        - --check-leaked-resources
        - --cluster=
        - --env=ENABLE_AUTH_PROVIDER_GCP=true
        - --env=KUBE_FEATURE_GATES=DisableKubeletCloudCredentialProviders=true
        - --extract=ci/latest
        - --gcp-zone=us-west1-b
        - --gcp-node-image=gci
        - --gcp-nodes=1
        - --provider=gce
        - --test_args=--ginkgo.focus=\[Feature:KubeletCredentialProviders\]
        image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
        resources:
          limits:
            cpu: 4
            memory: 6Gi
          requests:
            cpu: 4
            memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-kubelet
    testgrid-tab-name: gcp-kubelet-credential-provider
    description: "tests feature gcp kubelet image credential provider"
- name: ci-cos-cgroupv2-inplace-pod-resize-containerd-main-e2e-gce-serial
  cluster: k8s-infra-prow-build
  interval: 24h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 180m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - command:
        - runner.sh
        - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --env=KUBE_FEATURE_GATES=InPlacePodVerticalScaling=true
      - --env=ENABLE_POD_SECURITY_POLICY=true
      - --env=KUBE_MASTER_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
      - --env=KUBE_NODE_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv2/env-cgroupv2
      - --env=KUBELET_TEST_ARGS=--runtime-cgroups=/system.slice/containerd.service --fail-cgroupv1=true --cgroup-driver=systemd
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-nodes=1
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=1
      - --image-family=cos-stable
      - --image-project=cos-cloud
      - --provider=gce
      # Currently, in-place pod resize tests have two SIGDescribe jobs:
      #   var _ = SIGDescribe("[Serial] Pod InPlace Resize Container (scheduler-focussed) [Feature:InPlacePodVerticalScaling]", func() {
      #   var _ = SIGDescribe("Pod InPlace Resize Container [Feature:InPlacePodVerticalScaling]", func()
      # This job does not focus on serial but runs both in serial. Work item to add parallel tests is tracked by issue kubernetes/kubernetes#116431
      - --test_args=--ginkgo.focus=\[Feature:InPlacePodVerticalScaling\] --minStartupPods=1
      - --timeout=150m
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi
  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv2-inplace-pod-resize-containerd-e2e-serial
    description: Runs cluster e2e pod resize tests in serial with FOCUS=[Feature:InPlacePodVerticalScaling] with cgroup v2
- name: ci-cos-cgroupv1-inplace-pod-resize-containerd-main-e2e-gce-serial
  cluster: k8s-infra-prow-build
  interval: 48h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-e2e-containerd: "true"
  decorate: true
  decoration_config:
    timeout: 180m
  extra_refs:
  - org: kubernetes
    repo: kubernetes
    base_ref: master
    path_alias: k8s.io/kubernetes
    workdir: true
  - org: containerd
    repo: containerd
    base_ref: main
    path_alias: github.com/containerd/containerd
  - org: kubernetes
    repo: test-infra
    base_ref: master
    path_alias: k8s.io/test-infra
  spec:
    containers:
    - image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241016-ea6eab1555-master
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --check-leaked-resources
      - --env=KUBE_FEATURE_GATES=InPlacePodVerticalScaling=true
      - --env=ENABLE_POD_SECURITY_POLICY=true
      - --env=KUBE_MASTER_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/master.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/env-cgroupv1
      - --env=KUBE_NODE_EXTRA_METADATA=user-data=/home/prow/go/src/github.com/containerd/containerd/test/e2e/node.yaml,containerd-configure-sh=/home/prow/go/src/github.com/containerd/containerd/cluster/gce/configure.sh,containerd-extra-init-sh=/home/prow/go/src/github.com/containerd/containerd/test/e2e_node/gci-init.sh,containerd-env=/home/prow/go/src/k8s.io/test-infra/jobs/e2e_node/containerd/containerd-main/cgroupv1/env-cgroupv1
      - --env=KUBELET_TEST_ARGS=--runtime-cgroups=/system.slice/containerd.service
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-nodes=1
      - --gcp-zone=us-west1-b
      - --ginkgo-parallel=1
      - --image-family=cos-stable
      - --image-project=cos-cloud
      - --provider=gce
      # Currently, in-place pod resize tests have two SIGDescribe jobs:
      #   var _ = SIGDescribe("[Serial] Pod InPlace Resize Container (scheduler-focussed) [Feature:InPlacePodVerticalScaling]", func() {
      #   var _ = SIGDescribe("Pod InPlace Resize Container [Feature:InPlacePodVerticalScaling]", func()
      # This job does not focus on serial but runs both in serial. Work item to add parallel tests is tracked by issue kubernetes/kubernetes#116431
      - --test_args=--ginkgo.focus=\[Feature:InPlacePodVerticalScaling\] --minStartupPods=1
      - --timeout=150m
      resources:
        limits:
          cpu: 4
          memory: 6Gi
        requests:
          cpu: 4
          memory: 6Gi

  annotations:
    testgrid-dashboards: sig-node-containerd
    testgrid-tab-name: cos-cgroupv1-inplace-pod-resize-containerd-e2e-serial
    description: Runs cluster e2e pod resize tests in serial with FOCUS=[Feature:InPlacePodVerticalScaling] with cgroup v1
